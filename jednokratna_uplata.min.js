import{addInputProcent,addInputValue,createPlMin,getAccumulatedAmount,getConfigValue,getDocument,getFutureAccumulatedSum,getFuturePension,getMonthlyIncomeRate,getNumOfPayments,PMT,rate,restrictValueMax,separator,writePrecent}from"./calculations2.js";import tarifnik from"./config.js";const rangeIDS=["rangeIznosUplateJed","rangeGodinaPocetkaUplateJed","rangeGodinaPovlacenjeJed","rangeStopaPrinosaJed","rangePeriodIsplateGodinamaJed"],inputIDS=["inputIznosUplateJed","inputUlaznaNaknadaJad","inputGodinaPocetkaUplateJed","inputGodinaPovlacenjeJed","inputPeriodAkumulacijeJed","inputStopaPrinosaJed","inputUplacenoJed","inputZaradjenoJed","inputAkumuliranaSumaJed","inputPeriodIsplateGodinamaJed","inputIznosIsplateMesecnoJed","inputUkupanIznosIsplacenihSredstavaJed","btnJednokratno"],notToWrite=["inputIznosUplateJed","inputGodinaPocetkaUplateJed","inputGodinaPovlacenjeJed","inputStopaPrinosaJed","inputPeriodIsplateGodinamaJed","btnJednokratno"],plusMinusIDS=[],objRanges={},objInputs={},objPlusMinus={},globalValues={};createPlMin(plusMinusIDS,5,"Jed"),getDocument(inputIDS,objInputs),getDocument(rangeIDS,objRanges),getDocument(plusMinusIDS,objPlusMinus);const{btnJednokratno:btnJednokratno}=objInputs;function getFromInput({inputIznosUplateJed:e,inputGodinaPocetkaUplateJed:a,inputGodinaPovlacenjeJed:t,inputStopaPrinosaJed:n,inputPeriodIsplateGodinamaJed:l}){globalValues.inputIznosUplateJedVal=parseFloat(e.dataset.value),globalValues.inputGodinaPocetkaUplateJedVal=parseFloat(a.dataset.value),globalValues.inputGodinaPovlacenjeJedVal=parseFloat(t.dataset.value),globalValues.inputStopaPrinosaJedVal=parseFloat(n.dataset.value),globalValues.inputPeriodIsplateGodinamaJedVal=parseFloat(l.dataset.value)}function calculate(){let e=globalValues.inputGodinaPovlacenjeJedVal-globalValues.inputGodinaPocetkaUplateJedVal;globalValues.inputUlaznaNaknadaJadVal=getConfigValue(globalValues.inputIznosUplateJedVal,tarifnik),globalValues.inputPeriodAkumulacijeJedVal=e>=0?e:0,globalValues.inputUplacenoJedVal=globalValues.inputIznosUplateJedVal,globalValues.inputAkumuliranaSumaJedVal=accumulateSum(globalValues),globalValues.inputZaradjenoJedVal=earned(globalValues),globalValues.inputIznosIsplateMesecnoJedVal=monthlyPay(globalValues),globalValues.inputUkupanIznosIsplacenihSredstavaJedVal=sumPaid(globalValues)}function write(){inputIDS.forEach((e=>{if(!notToWrite.some((a=>a===e))){const a=globalValues[`${e}Val`];objInputs[e].dataset.value=a;const t=["inputUlaznaNaknadaJad"];let n=writePrecent(objInputs[e].id,t),l=separator(a.toFixed(2));objInputs[e].value=n?`${l}%`:l}}))}function sumPaid({inputIznosIsplateMesecnoJedVal:e,inputPeriodIsplateGodinamaJedVal:a}){return e*a*12}function monthlyPay({inputAkumuliranaSumaJedVal:e,inputStopaPrinosaJedVal:a,inputPeriodIsplateGodinamaJedVal:t}){let n=getMonthlyIncomeRate(a),l=getNumOfPayments(t),o=getFuturePension(e,n,l),u=rate(a),i=PMT(u,12*t,-1*e);return a?o:i}function earned({inputAkumuliranaSumaJedVal:e,inputUplacenoJedVal:a}){return e-a}function accumulateSum({inputIznosUplateJedVal:e,inputUlaznaNaknadaJadVal:a,inputStopaPrinosaJedVal:t,inputPeriodAkumulacijeJedVal:n}){let l=getAccumulatedAmount(e,a);return getFutureAccumulatedSum(l,t,n)}function callPlusMinus(e,a,t){for(let n in e)e[n].addEventListener("click",(()=>{onPlMiClick(`${n}`,e[n].dataset.field,a,t),getFromInput(a),calculate(),write()}))}function onPlMiClick(e,a,t,n){let l=e.slice(0,-1),o=t[a.replace("range","input")],u=n[a],i=parseFloat(u.step),d=parseFloat(u.max),p=parseFloat(u.value);"buttonPlusJed"===l?plusClicked(o,u,i,d,p):minusClicked(o,u,i,d,p)}function plusClicked(e,a,t,n,l){if(l<n)if("inputStopaPrinosaJed"===e.id){let n=parseFloat(l)+parseFloat(t);addInputProcent(e,n.toFixed(2),"inputStopaPrinosaJed"),a.value=n}else{let n=parseInt(l)+parseInt(t);addInputValue(e,n,"inputStopaPrinosaJed"),a.value=n}}function minusClicked(e,a,t,n,l){if(l&&l>0)if("inputStopaPrinosaJed"===e.id){let n=parseFloat(l)-parseFloat(t);addInputProcent(e,n.toFixed(2),"inputStopaPrinosaJed"),a.value=n}else{let n=parseInt(l)-parseInt(t);addInputValue(e,n,"inputStopaPrinosaJed"),a.value=n}else e.dataset.value=0,a.value=0}function changInputFields(a){const{inputIznosUplateJed:t,inputGodinaPocetkaUplateJed:n,inputGodinaPovlacenjeJed:l,inputStopaPrinosaJed:o,inputPeriodIsplateGodinamaJed:u}=a;[t,n,l,o,u].forEach((t=>{let n=!1;t.addEventListener("click",(()=>{"inputStopaPrinosaJed"===t.id?e.preventDefault():(t.value="",n=!1)})),t.addEventListener("keypress",(e=>{if("inputStopaPrinosaJed"===t.id){e.preventDefault();let a=45===e.which||47===e.which;(e.which<44&&a&&!n||e.which>57&&!n)&&e.preventDefault(),44!==e.which&&46!==e.which||(n=!0)}else(e.which<48||e.which>57)&&e.preventDefault()})),t.addEventListener("focusout",(()=>{})),t.addEventListener("keyup",(e=>{let n="inputStopaPrinosaJed"===t.id,l=t.dataset.value,o=e.target.value,{returnValue:u,minAllow:i,maxAllow:d,commaAllow:p}=restrictValueMax(t,o,e,l,n);i&&d&&!n?(addInputValue(t,u,"inputStopaPrinosaJed"),getFromInput(a),calculate(),write()):(i||n)&&(d||n)||addInputValue(t,l,"inputStopaPrinosaJed")}))}))}function renderanjePieJednokratnaUplata(){globalValues.renderanjePrvo=parseFloat(inputIznosUplateJed.dataset.value),globalValues.renderanjeDrugo=parseFloat(inputZaradjenoJed.dataset.value);var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;e>768&&new CanvasJS.Chart("chartContainerJednokratna",{animationEnabled:!0,legend:{horizontalAlign:"right",verticalAlign:"center",fontSize:"18",fontColor:"#6b472f",markerMargin:10},data:[{type:"pie",indexLabelPlacement:"inside",indexLabelFontColor:"#fff",indexLabelFontSize:"11",startAngle:270,showInLegend:"true",legendText:"{label}",legendPosition:"right",yValueFormatString:"#,###.##",indexLabel:"{y}",dataPoints:[{y:globalValues.renderanjePrvo,label:"Ukupno uplaćeno",color:"#6A472F"},{y:globalValues.renderanjeDrugo,label:"Zarađeno",color:"#937968"}]}]}).render()}rangeIDS.forEach((e=>{objRanges[e].addEventListener("input",(a=>{const t=e.replace("range","input");objInputs[t].dataset.value=a.target.value,getFromInput(objInputs),calculate(),write()}))})),btnJednokratno.addEventListener("click",(()=>{getFromInput(objInputs),calculate(),write(),renderanjePieJednokratnaUplata()})),callPlusMinus(objPlusMinus,objInputs,objRanges),changInputFields(objInputs),getFromInput(objInputs),calculate(),write();