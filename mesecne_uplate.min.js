import{addInputProcent,addInputValue,createPlMin,FV,getAccumulatedAmount,getAccumulatedSum,getConfigValue,getDocument,getFuturePension,getMonthlyIncomeRate,getNumOfPayments,percenageToNumber,PMT,rate,restrictValueMax,separator,writePrecent}from"./calculations2.js";import tarifnik from"./config.js";const rangeIDS=["rangeIznosUplateClanaMes","rangeIznosUplatePoslodavcaMes","rangeGodinaPocetkaUplateMes","rangeGodinaPovlacenjeMes","rangeStopaPrinosaMes","rangePeriodIsplateGodinamaMes"],inputIDS=["inputIznosUplateClanaMes","inputIznosUplatePoslodavcaMes","inputUlaznaNaknadaClanaMes","inputUlaznaNaknadaPoslodavcaMes","inputGodinaPocetkaUplateMes","inputGodinaPovlacenjeMes","inputPeriodAkumulacijeMes","inputStopaPrinosaMes","inputUkupnoUplacenoClanaMes","inputUkupnoUplacenoPoslodavcaMes","inputZaradjenoMes","inputAkumuliranaSumaClanaMes","inputAkumuliranaSumaPoslodavcaMes","inputAkumuliranaSumaMes","inputPeriodIsplateGodinamaMes","inputIznosIsplateMesecnoMes","inputUkupanIznosIsplacenihSredstavaMes","btnMesecno"],notToWrite=["inputIznosUplateClanaMes","inputIznosUplatePoslodavcaMes","inputGodinaPovlacenjeMes","inputGodinaPocetkaUplateMes","inputStopaPrinosaMes","inputPeriodIsplateGodinamaMes","btnMesecno"],plusMinusIDS=[],objRanges={},objInputs={},objPlusMinus={},globalValues={};createPlMin(plusMinusIDS,6,"Mes"),getDocument(inputIDS,objInputs),getDocument(rangeIDS,objRanges),getDocument(plusMinusIDS,objPlusMinus);const{btnMesecno:btnMesecno}=objInputs;function getFromInput({inputIznosUplateClanaMes:a,inputIznosUplatePoslodavcaMes:e,inputGodinaPovlacenjeMes:n,inputGodinaPocetkaUplateMes:l,inputStopaPrinosaMes:t,inputPeriodIsplateGodinamaMes:o}){globalValues.inputIznosUplateClanaMesVal=parseFloat(a.dataset.value),globalValues.inputIznosUplatePoslodavcaMesVal=parseFloat(e.dataset.value),globalValues.inputGodinaPovlacenjeMesVal=parseFloat(n.dataset.value),globalValues.inputGodinaPocetkaUplateMesVal=parseFloat(l.dataset.value),globalValues.inputStopaPrinosaMesVal=parseFloat(t.dataset.value),globalValues.inputPeriodIsplateGodinamaMesVal=parseFloat(o.dataset.value)}function calculate(){let a=globalValues.inputGodinaPovlacenjeMesVal-globalValues.inputGodinaPocetkaUplateMesVal;globalValues.inputUlaznaNaknadaClanaMesVal=getConfigValue(globalValues.inputIznosUplateClanaMesVal,tarifnik),globalValues.inputUlaznaNaknadaPoslodavcaMesVal=getConfigValue(globalValues.inputIznosUplatePoslodavcaMesVal,tarifnik),globalValues.inputPeriodAkumulacijeMesVal=a>=0?a:0,globalValues.inputUkupnoUplacenoClanaMesVal=12*globalValues.inputPeriodAkumulacijeMesVal*globalValues.inputIznosUplateClanaMesVal,globalValues.inputUkupnoUplacenoPoslodavcaMesVal=12*globalValues.inputPeriodAkumulacijeMesVal*globalValues.inputIznosUplatePoslodavcaMesVal,globalValues.inputAkumuliranaSumaClanaMesVal=accumulateSum(globalValues),globalValues.inputAkumuliranaSumaPoslodavcaMesVal=accumulateSum(globalValues,!1),globalValues.inputAkumuliranaSumaMesVal=globalValues.inputAkumuliranaSumaClanaMesVal+globalValues.inputAkumuliranaSumaPoslodavcaMesVal,globalValues.inputZaradjenoMesVal=globalValues.inputAkumuliranaSumaMesVal-globalValues.inputUkupnoUplacenoClanaMesVal-globalValues.inputUkupnoUplacenoPoslodavcaMesVal,globalValues.inputIznosIsplateMesecnoMesVal=monthlyPay(globalValues),globalValues.inputUkupanIznosIsplacenihSredstavaMesVal=globalValues.inputIznosIsplateMesecnoMesVal*globalValues.inputPeriodIsplateGodinamaMesVal*12}function write(){inputIDS.forEach((a=>{if(!notToWrite.some((e=>e===a))){const e=parseFloat(globalValues[`${a}Val`]);objInputs[a].dataset.value=e;const n=["inputUlaznaNaknadaClanaMes","inputUlaznaNaknadaPoslodavcaMes"];let l=writePrecent(objInputs[a].id,n),t=separator(e.toFixed(2));objInputs[a].value=l?`${t}%`:t}}))}function accumulateSum({inputIznosUplateClanaMesVal:a,inputIznosUplatePoslodavcaMesVal:e,inputUlaznaNaknadaClanaMesVal:n,inputUlaznaNaknadaPoslodavcaMesVal:l,inputStopaPrinosaMesVal:t,inputPeriodAkumulacijeMesVal:o},u=!0){let s=u?a:e,i=u?n:l,p=getAccumulatedAmount(s,i),r=globalValues.monthlyIncomeRate=getMonthlyIncomeRate(t),d=globalValues.numOfPayments=getNumOfPayments(o),c=getAccumulatedSum(p,r,d),M=rate(t),g=12*o,m=percenageToNumber(i),V=-1*FV(M,g,s*(1-m),0,1);return t?c:V}function monthlyPay({inputAkumuliranaSumaMesVal:a,monthlyIncomeRate:e,numOfPayments:n,inputStopaPrinosaMesVal:l,inputPeriodIsplateGodinamaMesVal:t}){getFuturePension(a,e,n);let o=rate(l),u=PMT(o,12*t,-1*a);return u}function callPlusMinus(a,e,n){for(let l in a)a[l].addEventListener("click",(()=>{onPlMiClick(`${l}`,a[l].dataset.field,e,n),getFromInput(e),calculate(),write()}))}function onPlMiClick(a,e,n,l){let t=a.slice(0,-1),o=n[e.replace("range","input")],u=l[e],s=parseFloat(u.step),i=parseFloat(u.max),p=parseFloat(u.value);"buttonPlusMes"===t?plusClicked(o,u,s,i,p):minusClicked(o,u,s,i,p)}function plusClicked(a,e,n,l,t){if(t<l)if("inputStopaPrinosaMes"===a.id){let l=parseFloat(t)+parseFloat(n);addInputProcent(a,l.toFixed(2),"inputStopaPrinosaMes"),e.value=l}else{let l=parseInt(t)+parseInt(n);addInputValue(a,l,"inputStopaPrinosaMes"),e.value=l}}function minusClicked(a,e,n,l,t){if(t&&t>0)if("inputStopaPrinosaMes"===a.id){let l=parseFloat(t)-parseFloat(n);addInputProcent(a,l.toFixed(2),"inputStopaPrinosaMes"),e.value=l}else{let l=parseInt(t)-parseInt(n);l<200&&(l=0),addInputValue(a,l,"inputStopaPrinosaMes"),e.value=l}else a.dataset.value=0,e.value=0}function changInputFields(a){const{inputGodinaPocetkaUplateMes:n,inputGodinaPovlacenjeMes:l,inputStopaPrinosaMes:t,inputIznosUplateClanaMes:o,inputIznosUplatePoslodavcaMes:u,inputPeriodIsplateGodinamaMes:s}=a;[n,l,t,o,u,s].forEach((n=>{let l=!1;n.addEventListener("click",(()=>{"inputStopaPrinosaMes"===n.id?e.preventDefault():(n.value="",l=!1)})),n.addEventListener("keypress",(a=>{if("inputStopaPrinosaMes"===n.id){a.preventDefault();let e=45===a.which||47===a.which;(a.which<44&&e&&!l||a.which>57&&!l)&&a.preventDefault(),44!==a.which&&46!==a.which||(l=!0)}else(a.which<48||a.which>57)&&a.preventDefault()})),n.addEventListener("focusout",(()=>{})),n.addEventListener("keyup",(e=>{if("inputIznosUplateClanaMes"==n.id)setTimeout((function(){let l="inputStopaPrinosaMes"===n.id,t=n.dataset.value,o=e.target.value,{returnValue:u,minAllow:s,maxAllow:i,commaAllow:p}=restrictValueMax(n,o,e,t,l);if(s&&i&&!l){u<200&&(u="0"),addInputValue(n,u,"inputStopaPrinosaMes"),getFromInput(a),calculate(),write();var r=document.getElementById("specialIdrangeIznosUplateClanaMes");r.innerHTML=parseInt(u);var d=Number(100*(u-200)/29800);r.style.left="calc("+d+"% + ("+(20-.4*d)+"px))",document.getElementById("rangeIznosUplateClanaMes").value=parseInt(u)}else(s||l)&&(i||l)||addInputValue(n,t,"inputStopaPrinosaMes")}),1e3);else{let l="inputStopaPrinosaMes"===n.id,t=n.dataset.value,o=e.target.value,{returnValue:u,minAllow:s,maxAllow:i,commaAllow:p}=restrictValueMax(n,o,e,t,l);s&&i&&!l?(addInputValue(n,u,"inputStopaPrinosaMes"),getFromInput(a),calculate(),write()):(s||l)&&(i||l)||addInputValue(n,t,"inputStopaPrinosaMes")}}))}))}function renderanjePie(){globalValues.renderanjePrvo=parseFloat(inputUkupnoUplacenoClanaMes.dataset.value),globalValues.renderanjeDrugo=parseFloat(inputUkupnoUplacenoPoslodavcaMes.dataset.value),globalValues.renderanjeTrece=parseFloat(inputZaradjenoMes.dataset.value);var a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;a>768&&new CanvasJS.Chart("chartContainer",{animationEnabled:!0,legend:{horizontalAlign:"right",verticalAlign:"center",fontSize:"20",fontColor:"#6b472f",markerMargin:10},data:[{type:"pie",indexLabelPlacement:"inside",indexLabelFontColor:"#fff",indexLabelFontSize:"11",startAngle:270,showInLegend:"true",legendText:"{label}",legendPosition:"right",yValueFormatString:"#,###.##",indexLabel:"{y}",dataPoints:[{y:globalValues.renderanjePrvo,label:"Ukupno uplaćeno od strane člana",color:"#de6470"},{y:globalValues.renderanjeDrugo,label:"Ukupno uplaćeno od strane poslodavca",color:"#f7d0d4"},{y:globalValues.renderanjeTrece,label:"Zarađeno",color:"#dd2e3e"}]}]}).render()}rangeIDS.forEach((a=>{objRanges[a].addEventListener("input",(e=>{const n=a.replace("range","input");objInputs[n].dataset.value=e.target.value,getFromInput(objInputs),calculate(),write()}))})),btnMesecno.addEventListener("click",(()=>{getFromInput(objInputs),calculate(),write(),renderanjePie()})),callPlusMinus(objPlusMinus,objInputs,objRanges),changInputFields(objInputs),getFromInput(objInputs),calculate(),write(),document.addEventListener("DOMContentLoaded",renderanjePie(),!1);