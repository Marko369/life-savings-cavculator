import{addInputProcent,addInputValue,createPlMin,FV,getAccumulatedAmount,getAccumulatedSum,getConfigValue,getDocument,getFutureAccumulatedSum,getFuturePension,getMonthlyIncomeRate,getNumOfPayments,percenageToNumber,PMT,rate,restrictValueMax,separator,writePrecent}from"./calculations2.js";import tarifnik from"./config.js";const rangeIDS=["rangeTrenutnoStanjeKli","rangeIznosUplateMesKli","rangeGodinaPocetkaUplateKli","rangeGodinaPovlacenjeKli","rangeStopaPrinosaKli","rangePeriodIsplateGodinamaKli"],inputIDS=["inputTrenutnoStanjeKli","inputIznosUplateMesKli","inputUlaznaNaknadaKli","inputGodinaPocetkaUplateKli","inputGodinaPovlacenjeKli","inputPeriodAkumulacijeKli","inputStopaPrinosaKli","inputUkupnoUplacenoKli","inputZaradjenoKli","inputAkumuliranaTrenutnoKli","inputAkumuliranaMesKli","inputAkumuliranaSumaKli","inputPeriodIsplateGodinamaKli","inputIznosIsplateMesecnoKli","inputUkupanIznosIsplacenihSredstavaKli","btnKli"],notToWrite=["inputIznosUplateMesKli","inputGodinaPovlacenjeKli","inputGodinaPocetkaUplateKli","inputStopaPrinosaKli","inputTrenutnoStanjeKli","inputPeriodIsplateGodinamaKli","btnKli"],plusMinusIDS=[],objRanges={},objInputs={},objPlusMinus={},globalValues={};createPlMin(plusMinusIDS,6,"Kor"),getDocument(inputIDS,objInputs),getDocument(rangeIDS,objRanges),getDocument(plusMinusIDS,objPlusMinus);const{btnKli:btnKli}=objInputs;function getFromInput({inputIznosUplateMesKli:a,inputGodinaPovlacenjeKli:e,inputGodinaPocetkaUplateKli:l,inputStopaPrinosaKli:t,inputTrenutnoStanjeKli:n,inputPeriodIsplateGodinamaKli:i}){globalValues.inputIznosUplateMesKliVal=parseFloat(a.dataset.value),globalValues.inputGodinaPovlacenjeKliVal=parseFloat(e.dataset.value),globalValues.inputGodinaPocetkaUplateKliVal=parseFloat(l.dataset.value),globalValues.inputStopaPrinosaKliVal=parseFloat(t.dataset.value),globalValues.inputTrenutnoStanjeKliVal=parseFloat(n.dataset.value),globalValues.inputPeriodIsplateGodinamaKliVal=parseFloat(i.dataset.value)}function calculate(){let a=globalValues.inputGodinaPovlacenjeKliVal-globalValues.inputGodinaPocetkaUplateKliVal;globalValues.inputUlaznaNaknadaKliVal=getConfigValue(globalValues.inputIznosUplateMesKliVal,tarifnik),globalValues.inputPeriodAkumulacijeKliVal=a>=0?a:0,globalValues.inputUkupnoUplacenoKliVal=12*globalValues.inputPeriodAkumulacijeKliVal*globalValues.inputIznosUplateMesKliVal,globalValues.inputAkumuliranaTrenutnoKliVal=accumulateSum(globalValues),globalValues.inputAkumuliranaMesKliVal=accumulateMonSum(globalValues),globalValues.inputAkumuliranaSumaKliVal=(globalValues.inputAkumuliranaTrenutnoKliVal+globalValues.inputAkumuliranaMesKliVal).toFixed(2),globalValues.inputZaradjenoKliVal=earnedFunds(globalValues).toFixed(2),globalValues.inputIznosIsplateMesecnoKliVal=monthlyPay(globalValues),globalValues.inputUkupanIznosIsplacenihSredstavaKliVal=sumPaid(globalValues).toFixed(2)}function write(){inputIDS.forEach((a=>{if(!notToWrite.some((e=>e===a))){const e=parseFloat(globalValues[`${a}Val`]);objInputs[a].dataset.value=e;const l=["inputUlaznaNaknadaKli"];let t=writePrecent(objInputs[a].id,l),n=separator(e.toFixed(2));objInputs[a].value=t?`${n}%`:n}}))}function sumPaid({inputIznosIsplateMesecnoKliVal:a,inputPeriodIsplateGodinamaKliVal:e}){return a*e*12}function monthlyPay({inputAkumuliranaSumaKliVal:a,monthlyIncomeRate:e,inputPeriodIsplateGodinamaKliVal:l,inputStopaPrinosaKliVal:t,inputUkupanIznosIsplacenihSredstavaKliVal:n}){let i=getNumOfPayments(l),u=getFuturePension(a,e,i),o=rate(t),s=PMT(o,12*l,-1*a);return t?u:s}function earnedFunds({inputAkumuliranaSumaKliVal:a,inputTrenutnoStanjeKliVal:e,inputUkupnoUplacenoKliVal:l}){return a-e-l}function accumulateSum({inputTrenutnoStanjeKliVal:a,inputStopaPrinosaKliVal:e,inputPeriodAkumulacijeKliVal:l}){let t=getFutureAccumulatedSum(a,e,l),n=rate(e),i=-1*FV(n,12*l,0,a,1);return e?t:i}function accumulateMonSum({inputIznosUplateMesKliVal:a,inputUlaznaNaknadaKliVal:e,inputPeriodAkumulacijeKliVal:l,inputStopaPrinosaKliVal:t}){let n=a,i=e,u=getAccumulatedAmount(n,i),o=globalValues.monthlyIncomeRate=getMonthlyIncomeRate(t),s=globalValues.numOfPayments=getNumOfPayments(l),p=getAccumulatedSum(u,o,s),r=rate(t),d=12*l,c=percenageToNumber(i),K=-1*FV(r,d,n*(1-c),0,1);return t?p:K}function callPlusMinus(a,e,l){for(let t in a)a[t].addEventListener("click",(()=>{onPlMiClick(`${t}`,a[t].dataset.field,e,l),getFromInput(e),calculate(),write()}))}function onPlMiClick(a,e,l,t){let n=a.slice(0,-1),i=l[e.replace("range","input")],u=t[e],o=parseFloat(u.step),s=parseFloat(u.max),p=parseFloat(u.value);"buttonPlusKor"===n?plusClicked(i,u,o,s,p):minusClicked(i,u,o,s,p)}function plusClicked(a,e,l,t,n){if(n<t)if("inputStopaPrinosaKli"===a.id){let t=parseFloat(n)+parseFloat(l);addInputProcent(a,t.toFixed(2),"inputStopaPrinosaKli"),e.value=t}else{let t=parseInt(n)+parseInt(l);addInputValue(a,t,"inputStopaPrinosaKli"),e.value=t}}function minusClicked(a,e,l,t,n){if(n&&n>0)if("inputStopaPrinosaKli"===a.id){let t=parseFloat(n)-parseFloat(l);addInputProcent(a,t.toFixed(2),"inputStopaPrinosaKli"),e.value=t}else{let t=parseInt(n)-parseInt(l);addInputValue(a,t,"inputStopaPrinosaKli"),e.value=t}else a.dataset.value=0,e.value=0}function changInputFields(a){const{inputTrenutnoStanjeKli:e,inputIznosUplateMesKli:l,inputGodinaPocetkaUplateKli:t,inputGodinaPovlacenjeKli:n,inputStopaPrinosaKli:i,inputPeriodIsplateGodinamaKli:u}=a;[e,l,t,n,i,u].forEach((e=>{let l=!1;e.addEventListener("click",(a=>{"inputStopaPrinosaKli"===e.id?a.preventDefault():(e.value="",l=!1)})),e.addEventListener("keypress",(a=>{if("inputStopaPrinosaKli"===e.id){a.preventDefault();let e=45===a.which||47===a.which;(a.which<44&&e&&!l||a.which>57&&!l)&&a.preventDefault(),44!==a.which&&46!==a.which||(l=!0)}else(a.which<48||a.which>57)&&a.preventDefault()})),e.addEventListener("focusout",(()=>{})),e.addEventListener("keyup",(l=>{let t="inputStopaPrinosaKli"===e.id,n=e.dataset.value,i=l.target.value,{returnValue:u,minAllow:o,maxAllow:s,commaAllow:p}=restrictValueMax(e,i,l,n,t);o&&s&&!t?(addInputValue(e,u,"inputStopaPrinosaKli"),getFromInput(a),calculate(),write()):(o||t)&&(s||t)||addInputValue(e,n,"inputStopaPrinosaKli")}))}))}function renderanjePieUplataPostojeciKlijent(){globalValues.renderanjePrvo=parseFloat(inputTrenutnoStanjeKli.dataset.value),globalValues.renderanjeDrugo=parseFloat(inputUkupnoUplacenoKli.dataset.value),globalValues.renderanjeTrece=parseFloat(inputZaradjenoKli.dataset.value);var a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;a>768&&new CanvasJS.Chart("chartContainerUplataPostojeci",{animationEnabled:!0,legend:{horizontalAlign:"right",verticalAlign:"center",fontSize:"18",fontColor:"#6b472f",markerMargin:10},data:[{type:"pie",indexLabelPlacement:"inside",indexLabelFontColor:"#fff",indexLabelFontSize:"11",startAngle:270,showInLegend:"true",legendText:"{label}",legendPosition:"right",yValueFormatString:"#,###.##",indexLabel:"{y}",dataPoints:[{y:globalValues.renderanjePrvo,label:"Trenutno stanje",color:"#de6470"},{y:globalValues.renderanjeDrugo,label:"Uplaćena suma",color:"#f7d0d4"},{y:globalValues.renderanjeTrece,label:"Zarađeno",color:"#dd2e3e"}]}]}).render()}rangeIDS.forEach((a=>{objRanges[a].addEventListener("input",(e=>{const l=a.replace("range","input");objInputs[l].dataset.value=e.target.value,getFromInput(objInputs),calculate(),write()}))})),btnKli.addEventListener("click",(()=>{getFromInput(objInputs),calculate(),write(),renderanjePieUplataPostojeciKlijent()})),callPlusMinus(objPlusMinus,objInputs,objRanges),changInputFields(objInputs),getFromInput(objInputs),calculate(),write(),document.addEventListener("DOMContentLoaded",renderanjePieUplataPostojeciKlijent(),!1);